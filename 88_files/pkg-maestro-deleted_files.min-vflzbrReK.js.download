define("modules/clean/ajax_as_promised",["require","exports","modules/clean/ajax"],function(e,t,n){"use strict";function r(e){return function(t){return new Promise(function(n,r){return e(t).then(n,function(e,t,n){return r({jqXHR:e,textStatus:t,errorThrown:n})})})}}t.Request=r(n.Request),t.BackgroundRequest=r(n.BackgroundRequest),t.SilentBackgroundRequest=r(n.SilentBackgroundRequest),t.SilentBackgroundRequestOref=r(n.SilentBackgroundRequestOref),t.WebRequest=r(n.WebRequest),t.WebRequestOref=r(n.WebRequestOref),t.FormWebRequest=r(n.FormWebRequest),t.WebProgressRequest=r(n.WebProgressRequest),t.ValidationSchemaRequest=r(n.ValidationSchemaRequest),t.SilentBackgroundBeaconRequest=r(n.SilentBackgroundBeaconRequest)}),function(){define("modules/clean/events/rollback",["jquery","modules/core/browser","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/analytics","modules/clean/react/modal","modules/clean/ajax"],function(e,t,n,r,s,a,i,o,l){var c,u,d,p;return d=r._,p=r.ungettext,u=i.SupportExperimentsWebLogger,c={configureAllLinks:function(t,n,r,s,a){return null==r&&(r=null),null==s&&(s=void 0),null==a&&(a=void 0),e(t).on("click",n,function(t){var n,i,l,p,m,_;return null!=r&&u.log_file_restore(r),n=e(t.target),_=n.data("user-id"),l=n.data("ns-id"),i=n.data("cs-id"),p=n.data("redirect"),null==p&&(p=!0),m=s?n.data("sjids"):null,o.SimpleModal.show({title_text:d("Undo this deletion"),body_html:d("Are you sure you want to undo this deletion?"),confirm_text:d("Undo deletion"),confirm_callback:function(){return c.rollback(_,l,i,p,a,m,s)},cancel_text:d("Cancel")}),!1})},createRollbackHandler:function(e,t,r,s){var a,i;return i=p("Restore this file","Restore %(num)d files",s).format({num:s}),a=p("Are you sure you want to restore this file?","Are you sure you want to restore these %(num)d files?",s).format({num:s}),function(s){return s.stopPropagation(),o.SimpleModal.show({title_text:i,body_html:n.escape(a).toHTML(),confirm_text:d("Restore"),confirm_callback:function(){return c.rollback(e,t,r)},cancel_text:d("Cancel")}),!1}},rollback:function(e,n,r,i,o,c,u,p){var m;return null==o&&(o=void 0),null==c&&(c=null),null==u&&(u=!1),null==p&&(p=null),m={},u?(m[n]=c,l.WebProgressRequest({url:"/cmd/restore_sjids",data:{ns_to_sjids:JSON.stringify(m)},subject_user:e,html_in_error_msg:!0,progress_text:d("Restoring files..."),success:function(){if(s.success(d("Finished restoring files.")),"function"==typeof o&&o(),i)return p?t.replace_location(p):t.redirect(a({path:"/browse_cs/"+e+"/"+n+"/"+r}))}})):(m[n]=r,l.WebProgressRequest({url:"/cmd/restore_changesets",data:{ns_to_cs:JSON.stringify(m)},subject_user:e,html_in_error_msg:!0,progress_text:d("Restoring files..."),success:function(){if(s.success(d("Finished restoring files.")),"function"==typeof o&&o(),i)return p?t.replace_location(p):t.redirect(a({path:"/browse_cs/"+e+"/"+n+"/"+r}))}}))}}})}.call(this),define("modules/clean/react/maestro/filter_view",["require","exports","tslib","external/classnames","external/mcl/dropdown_menu","external/react","modules/clean/react/calendar","modules/clean/react/css","modules/clean/react_logger","modules/core/i18n"],function(e,t,n,r,s,a,i,o,l,c){"use strict";var u=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.getDefaultNSFilter=function(){return{value:"all",displayValue:c._("All events")}},t.prototype.getNSDisplayValue=function(){var e=this;if(!this.props.activeNS)return this.getDefaultNSFilter().displayValue;var t=this.props.namespaces.find(function(t){return t.ns_id===e.props.activeNS});return t?t.name:""},t.prototype.renderNamespaceList=function(){var e=this.getDefaultNSFilter(),t=e.value,n=e.displayValue;return a.createElement(s.DropdownMenu,{onSelection:this.props.onNamespaceChange},a.createElement(s.DropdownMenuButton,{disabled:this.props.disabled},this.getNSDisplayValue()),a.createElement(s.Menu,null,a.createElement(s.MenuItem,{value:t},n),this.props.namespaces.map(function(e){return a.createElement(s.MenuItem,{value:e.ns_id,key:e.ns_id},e.name)})))},t.prototype.render=function(){return a.createElement("ul",{className:r("filter-item-list",this.props.className)},a.createElement("li",{className:"filter-item"},this.renderNamespaceList()),a.createElement("li",{className:"filter-item"},a.createElement(i.Calendar,{onDateChange:this.props.onDateChange,initDate:this.props.calendarInitDate,isMaestroDesign:!0,lastDay:this.props.calendarLastDay,alignAtLeft:this.props.calendarAlignAtLeft,disabled:this.props.disabled})))},t})(l.ReactLogger);t.FilterView=o(u,["/static/css/scooter/scooter-scoped-vfl0UVTY2.css","/static/css/dropbox/filter_menu-vflLfv6Ax.css"])}),define("modules/clean/react/trash/actions",["require","exports","tslib","external/underscore","modules/clean/react/trash/api","modules/clean/react/trash/constants","modules/clean/react/trash/selectors","modules/clean/react/trash/utils","modules/constants/ajax_strings","modules/core/notify","modules/core/i18n","modules/clean/js_client_stopwatch","modules/clean/web_timing_logger"],function(e,t,n,r,s,a,i,o,l,c,u,d,p){"use strict";function m(){c.error(l.PROBLEM_COMPLETING_REQUEST)}function _(){var e=this;return d.JSStopwatch.create_stopwatch_if_not_exist("maestro_trash_tracing"),function(t,l){return n.__awaiter(e,void 0,void 0,function(){var e,_,h,f,g,E,v,y,S,T,b,R,M,w,A,N,D,x;return n.__generator(this,function(n){switch(n.label){case 0:if(e=l(),_=e.fetchPhase,h=null,null!=_)return[2];f=e.user_id,g=e.ns_id,E=e.timestamp_ms,v=e.events,y=i.getHomeNsId(e),S=e.ns_id,T=Math.floor(Math.min(g?i.getEventsForNs(v,g).earliest:v.map(function(e){return e.earliest}).max(),E?E/1e3:1/0,Date.now()/1e3)),n.label=1;case 1:return n.trys.push([1,7,8,9]),t({type:a.START_FETCH_PHASE1}),b=s.tryPrefetchDeletions(f).catch(function(){return s.fetchDeletionsForNamespace({userId:f,nsId:S||y,earlierThan:T})}),b.then(function(){d.JSStopwatch.recordTrace("received_initial_events",{stopwatchName:"maestro_trash_tracing"})}),R=s.tryPrefetchNamespaceList(f).catch(function(){return s.fetchNamespaceList(f)}),R.then(function(){d.JSStopwatch.recordTrace("received_namespace_list",{stopwatchName:"maestro_trash_tracing"})}),[4,Promise.all([b,R])];case 2:return M=n.sent(),w=M[0],A=M[1],p.log_js_modules_fetched_data_required_for_tti(),t({type:a.COMPLETE_FETCH_PHASE1,deletionEvents:w,mountedNamespaces:A}),requestAnimationFrame(function(){h=c.info(u._("Loading deleted files..."),9999)}),[4,o.nextRAF()];case 3:return n.sent(),N=A.map(function(e){return e.ns_id}),S&&(N=r.without(N,S),N.push(y)),N.length>0?[4,s.fetchDeletionsForNamespaceMulti({userId:f,nsIds:N,earlierThan:T})]:[3,5];case 4:return D=n.sent(),t({type:a.COMPLETE_FETCH_PHASE2,deletionEvents:D,requestedNsIds:N}),[3,6];case 5:t({type:a.COMPLETE_FETCH_PHASE2,deletionEvents:[],requestedNsIds:[]}),n.label=6;case 6:return[3,9];case 7:throw x=n.sent(),m(),x;case 8:return c.current()&&c.current()===h&&c.clear(),[7];case 9:return[2]}})})}}function h(){var e=this;return function(t,r){return n.__awaiter(e,void 0,void 0,function(){var e,o,l,c,u,d,p,_;return n.__generator(this,function(n){switch(n.label){case 0:if(e=r(),e.isLoadingMore||e.fetchPhase!==a.FetchPhase.PHASE3)return[2];if(o=e.ns_id,l=e.events,o){if(!l.has(o)||l.get(o).done)return[2]}else if(l.every(function(e){return e.done}))return[2];t({type:a.REQUEST_MORE_DATA}),c=e.timestamp_ms,u=Math.floor(Math.min(o?i.getEventsForNs(l,o).earliest:l.filter(function(e){return!e.done}).map(function(e){return e.earliest}).max(),c?c/1e3:1/0,Date.now()/1e3)),d=o?[o]:l.filter(function(e){return!e.done}).keySeq().toArray(),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,s.fetchDeletionsForNamespaceMulti({userId:e.user_id,nsIds:d,earlierThan:u})];case 2:return p=n.sent(),t({type:a.RECEIVE_MORE_DATA,deletionEvents:p,requestedNsIds:d}),[3,4];case 3:return _=n.sent(),m(),t({type:a.FAIL_REQUESTING_MORE_DATA}),[3,4];case 4:return[2]}})})}}function f(e,t){return{type:a.REMOVE_ROW,ns_id:e,pkey:t}}function g(e){return function(t,n){t({type:a.SET_NAMESPACE,ns_id:e}),t(h())}}function E(e){return{type:a.TRASH_INIT,data:n.__assign({},e)}}function v(e){return{type:a.SET_EVENTS,events:n.__assign({},e)}}function y(){return function(e,t){var n=t().user_id;s.markRestoreFilesTipAsSeen(n),e({type:a.DISMISS_RESTORE_FILES_TIP})}}function S(e){return function(t){t({type:a.SET_TIMESTAMP,timestamp_ms:e}),t(h())}}t.initiateFetchPhases=_,t.loadMore=h,t.removeRow=f,t.setNamespace=g,t.initialize=E,t.setEvents=v,t.dismissRestoreFilesTip=y,t.setTimestampMs=S}),define("modules/clean/react/trash/api",["require","exports","tslib","modules/clean/ajax_as_promised","modules/clean/analytics"],function(e,t,n,r,s){"use strict";function a(e,t,r){return void 0===r&&(r={}),function(a){"abort"!==a.jqXHR.statusText&&s.WebMiscActivityLogger.log(t,n.__assign({},r,{is_prefetch:!1}),e)}}function i(e,t,r){return void 0===r&&(r={}),function(){return s.WebMiscActivityLogger.log(t,n.__assign({},r,{is_prefetch:!0}),e)}}function o(e){var t=window.__REGISTER_TRASH_PRELOAD_HANDLER;if(t){var n=new Promise(function(e,n){t(function(t){e(t.events)},n)});return n.catch(i(e,"trash-fetch-deletions-failure",{requested_ns_count:1})),n}return Promise.reject(null)}function l(e,t){return t.namespaces.map(function(t){return{name:t.name,user_id:e,ns_id:t.nsId}})}function c(e){var t=window.__REGISTER_TRASH_NS_LIST_PRELOAD_HANDLER;if(t){var n=new Promise(function(n,r){t(function(t){n(l(e,t))},r)});return n.catch(i(e,"trash-fetch-ns-list-failure")),n}return Promise.reject(null)}function u(e){var t=r.BackgroundRequest({type:"GET",url:"/trash/namespace_list",subject_user:e,dataType:"json"});return t.catch(a(e,"trash-fetch-ns-list-failure")),t.then(function(t){return l(e,t)})}function d(e){return p({userId:e.userId,nsIds:[e.nsId],earlierThan:e.earlierThan})}function p(e){var t={ns_ids:e.nsIds.join(","),timestamp:e.earlierThan},n=r.BackgroundRequest({type:"POST",url:"/deleted_files_with_mixed_cs/ajax",subject_user:e.userId,dataType:"json",data:t});return n.catch(a(e.userId,"trash-fetch-deletions-failure",{requested_ns_count:e.nsIds.length})),n.then(function(e){return e.events})}function m(e){return r.SilentBackgroundRequest({url:"/trash/seen_restore_files_tip",subject_user:e})}t.tryPrefetchDeletions=o,t.tryPrefetchNamespaceList=c,t.fetchNamespaceList=u,t.fetchDeletionsForNamespace=d,t.fetchDeletionsForNamespaceMulti=p,t.markRestoreFilesTipAsSeen=m}),define("modules/clean/react/trash/constants",["require","exports"],function(e,t){"use strict";t.ONE_DAY_MS=864e5;(function(e){e[e.PHASE1=1]="PHASE1",e[e.PHASE2=2]="PHASE2",e[e.PHASE3=3]="PHASE3"})(t.FetchPhase||(t.FetchPhase={})),t.START_FETCH_PHASE1="START_FETCH_PHASE1",t.COMPLETE_FETCH_PHASE1="COMPLETE_FETCH_PHASE1",t.COMPLETE_FETCH_PHASE2="COMPLETE_FETCH_PHASE2",t.REQUEST_MORE_DATA="REQUEST_MORE_DATA",t.RECEIVE_MORE_DATA="RECEIVE_MORE_DATA",t.FAIL_REQUESTING_MORE_DATA="FAIL_REQUESTING_MORE_DATA",t.SET_NAMESPACE="SET_NAMESPACE",t.SET_TIMESTAMP="SET_TIMESTAMP",t.SET_EVENTS="SET_EVENTS",t.TRASH_INIT="TRASH_INIT",t.REMOVE_ROW="REMOVE_ROW",t.DISMISS_RESTORE_FILES_TIP="DISMISS_RESTORE_FILES_TIP"}),define("modules/clean/react/trash/reducer",["require","exports","tslib","external/underscore","external/immutable","external/react","modules/clean/react/trash/constants"],function(e,t,n,r,s,a,i){"use strict";function o(e,t,n){if(0===t.length&&0===n.length)return e;var s=r.groupBy(t,"ns_id");return e.withMutations(function(e){r.each(s,function(t,n){var r=parseInt(n,10);if(e.has(r)){var s=e.get(r);t=t.filter(function(e){return e.timestamp<s.earliest});var a=s.events.concat(t);e.set(r,{earliest:Math.min.apply(Math,a.map(function(e){return e.timestamp})),events:a,done:!1})}else e.set(r,{earliest:Math.min.apply(Math,t.map(function(e){return e.timestamp})),events:t,done:!1})});for(var t=0,a=n;t<a.length;t++){var i=a[t];if(!s.hasOwnProperty(String(i))){var o=e.get(i);o&&(o.done=!0)}}return e})}function l(e,t,r){return n.__assign({},e,{events:o(s.Map(),t,[e.root_ns_ids[e.user_id]]),namespaces:s.List(r),fetchPhase:i.FetchPhase.PHASE2})}function c(e,t,r){return n.__assign({},e,{events:o(e.events,t,r),fetchPhase:i.FetchPhase.PHASE3})}function u(e,t,r){return n.__assign({},e,{events:o(e.events,t,r),isLoadingMore:!1})}function d(e){return{earliest:Number.MAX_VALUE,events:[],done:!1}}function p(e){var t=s.Map().withMutations(function(t){e.namespaces.forEach(function(n){n.user_id===e.user_id&&t.set(n.ns_id,d(n.ns_id))});var n=e.root_ns_ids[e.user_id];t.set(n,d(n))});return n.__assign({},e,{events:t})}function m(e){var t=e.ns_id,n=null!=t?e.events.get(t):null;return n?[n]:e.events.toArray()}function _(e){return Math.max.apply(Math,m(e).map(function(e){return e.earliest}))}function h(e,t){var r=1e3*_(e),s=n.__assign({},e,{timestamp_ms:t});return(r<0||t<r||t>e.latest_ms)&&(s=p(n.__assign({},s,{latest_ms:t}))),s}function f(e,t,s){var a=e.events,i=a.get(t),o=i?r.findIndex(i.events,function(e){return e.pkey===s}):-1;return o!==-1&&(a=a.update(t,function(e){return v(e,{events:{$splice:[[o,1]]}})})),n.__assign({},e,{events:a})}function g(e,t){return p(n.__assign({},e,{user_id:t.user_id,namespaces:s.List(t.ns_entries),root_ns_ids:t.root_ns_ids,timestamp_ms:t.date,latest_ms:t.date,ns_id:t.active_ns_id,seenRestoreFilesTip:t.seenRestoreFilesTip}))}function E(e,t){switch(t.type){case i.START_FETCH_PHASE1:return n.__assign({},e,{fetchPhase:i.FetchPhase.PHASE1});case i.COMPLETE_FETCH_PHASE1:return l(e,t.deletionEvents,t.mountedNamespaces);case i.COMPLETE_FETCH_PHASE2:return c(e,t.deletionEvents,t.requestedNsIds);case i.REQUEST_MORE_DATA:return n.__assign({},e,{isLoadingMore:!0});case i.RECEIVE_MORE_DATA:return u(e,t.deletionEvents,t.requestedNsIds);case i.FAIL_REQUESTING_MORE_DATA:return n.__assign({},e,{isLoadingMore:!1});case i.SET_NAMESPACE:return n.__assign({},e,{ns_id:t.ns_id});case i.SET_TIMESTAMP:return h(e,t.timestamp_ms);case i.SET_EVENTS:return n.__assign({},e,{events:t.events});case i.TRASH_INIT:return g(e,t.data);case i.REMOVE_ROW:return f(e,t.ns_id,t.pkey);case i.DISMISS_RESTORE_FILES_TIP:return n.__assign({},e,{seenRestoreFilesTip:!0});default:return e}}var v=a.addons.update;t.reducer=E}),define("modules/clean/react/trash/selectors",["require","exports","modules/clean/react/trash/constants"],function(e,t,n){"use strict";function r(e,t){return null==t?l:e.get(t,l)}function s(e){var t=e.ns_id,n=e.timestamp_ms,s=e.events;return Math.min(t?r(s,t).earliest:s.map(function(e){return e.earliest}).max(),n?n/1e3:1/0,Math.floor(Date.now()/1e3))}function a(e){return e.root_ns_ids[e.user_id]}function i(e){return e.fetchPhase!==n.FetchPhase.PHASE3||e.isLoadingMore}function o(e){var t=e.fetchPhase;return null===t||t===n.FetchPhase.PHASE1}var l=Object.freeze({earliest:+(1/0),events:Object.freeze([]),done:!0});t.getEventsForNs=r,t.earliestTimestampInSecs=s,t.getHomeNsId=a,t.isLoading=i,t.shouldDisableFilterView=o}),define("modules/clean/react/trash/store",["require","exports","external/immutable","external/redux","external/redux-thunk","modules/clean/react/trash/reducer"],function(e,t,n,r,s,a){"use strict";var i=r.compose,o=r.createStore(a.reducer,{user_id:0,ns_id:void 0,root_ns_ids:{},events:n.Map(),namespaces:n.List(),latest_ms:Number.MAX_VALUE,timestamp_ms:null,fetchPhase:null,isLoadingMore:!1,seenRestoreFilesTip:!1},i(r.applyMiddleware(s)));t.TrashStore=o}),define("modules/clean/react/trash/trash",["require","exports","tslib","external/mcl/scroll_monitor","external/react","external/react-redux","external/underscore","modules/clean/history","modules/clean/pagelet_logger","modules/clean/react/trash/actions","modules/clean/react/trash/constants","modules/clean/react/trash/selectors","modules/clean/react/trash/store","modules/clean/react/trash/trash_view","modules/clean/react/trash/utils","modules/clean/react_logger","modules/clean/viewer","modules/clean/web_timing_logger"],function(e,t,n,r,s,a,i,o,l,c,u,d,p,m,_,h,f,g){"use strict";function E(e){var t,n=e.ns_id;return t=n?[d.getEventsForNs(e.events,n)]:e.events.toList().toJS(),{namespaces:e.namespaces,root_ns_ids:e.root_ns_ids,active_ns_id:e.ns_id,loading:d.isLoading(e),timestamp_ms:e.timestamp_ms,seenRestoreFilesTip:e.seenRestoreFilesTip,filterViewDisabled:d.shouldDisableFilterView(e),valid_nss:t}}var v=Date.now(),y=(function(e){function t(t){var n=e.call(this,"Trash",t)||this;return n.pageletLogger=new l.PageletLogger("trash",["TrashView"]),n._currentFromBottom=null,n.state={user:f.get_viewer().get_user_by_id(n.props.user_id)},n.handleComponentReady=function(e){n.pageletLogger.componentReady(e)},n.handleDateChange=function(e){var t=Number(e);n.props.dispatch(c.setTimestampMs(t))},n.handleRestoreFilesTipDismiss=function(){n.props.dispatch(c.dismissRestoreFilesTip())},n.handleScroll=function(e){var t=e.fromBottom;n._currentFromBottom=t,n.loadMoreIfNearBottom()},n.removeRow=function(e,t){n.props.dispatch(c.removeRow(e,t))},n.updateNSFilter=function(e){var t="all"===e?null:e;n.props.dispatch(c.setNamespace(t))},n}return n.__extends(t,e),t.prototype.componentWillMount=function(){e.prototype.componentWillMount.call(this),g.log_js_modules_application_code_start()},t.prototype.componentDidMount=function(){this.props.dispatch(c.initiateFetchPhases()),e.prototype.componentDidMount.call(this)},t.prototype.componentDidUpdate=function(){this.setUrl()},t.prototype.setUrl=function(){if(this.props.timestamp_ms){var e=new Date(this.props.timestamp_ms),t=v-(this.props.timestamp_ms+u.ONE_DAY_MS)>0,n={};this.props.active_ns_id&&(n.ns=String(this.props.active_ns_id)),t&&(n.date=e.getDate()+"-"+(e.getMonth()+1)+"-"+e.getFullYear()),o.push_state("/deleted_files",n)}},t.prototype.getFilteredEvents=function(){var e=this;return i(i(i(this.props.valid_nss.map(function(e){return e.events})).flatten()).sortBy(function(e){return-e.timestamp})).filter(function(t){return t.timestamp>=-(1/0)&&t.timestamp<(e.props.timestamp_ms+u.ONE_DAY_MS)/1e3&&!(e.props.active_ns_id&&t.is_dup)})},t.prototype.getFilteredNamespaces=function(){var e=this;return this.props.namespaces.filter(function(t){return t.user_id===e.props.user_id})},t.prototype.loadMoreIfNearBottom=function(){null!==this._currentFromBottom&&this._currentFromBottom>=0&&this._currentFromBottom<=400&&this.props.dispatch(c.loadMore())},t.prototype.render=function(){return s.createElement("div",null,s.createElement(m.TrashView,{user:this.state.user,onDateChange:this.handleDateChange,calendarInitDate:new Date(this.props.initial_timestamp),calendarLastDay:new Date,activeNS:this.props.active_ns_id,defaultNS:this.props.initial_active_ns_id,events:this.getFilteredEvents(),namespaces:this.getFilteredNamespaces(),onNamespaceChange:this.updateNSFilter,onRemoveRow:this.removeRow,loading:this.props.loading,expBizUpsellUserType:this.props.exp_biz_upsell_user_type,handleComponentReady:this.handleComponentReady,seenRestoreFilesTip:this.props.seenRestoreFilesTip,onRestoreFilesTipDismiss:this.handleRestoreFilesTipDismiss,filterViewDisabled:this.props.filterViewDisabled}),s.createElement(r.ScrollMonitor,{onScroll:this.handleScroll}))},t})(h.ReactLogger),S=a.connect(E)(y),T=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.componentWillMount=function(){p.TrashStore.dispatch(c.initialize({date:this.getInitialTimestamp(),user_id:this.props.user_id,ns_entries:this.props.namespaces,root_ns_ids:this.props.root_ns_ids,active_ns_id:this.props.initial_active_ns_id,seenRestoreFilesTip:this.props.seenRestoreFilesTip}))},t.prototype.getInitialTimestamp=function(){var e=this.props.date_str;return e?_.parseDateFromString(e)||Date.now():Date.now()},t.prototype.render=function(){var e=this.props,t=e.initial_active_ns_id,n=e.exp_subgrowth_biz_deleted_files_upsell_user_type,r=e.user_id,i=this.getInitialTimestamp();return s.createElement(a.Provider,{store:p.TrashStore},s.createElement(S,{exp_biz_upsell_user_type:n,initial_active_ns_id:t,initial_timestamp:i,user_id:r}))},t})(s.Component);t.Trash=T}),define("modules/clean/react/trash/trash_view",["require","exports","tslib","external/classnames","external/mcl/media_table","external/mcl/table","external/mcl/tip_card","external/mcl/vertically_fixed","external/react","modules/clean/analytics","modules/clean/react/file_icon_view","modules/clean/react/file_path_breadcrumb","modules/clean/react/maestro/filter_view","modules/clean/react/maestro/header","modules/clean/react/maestro/layout","modules/clean/react/modal","modules/clean/react_format","modules/clean/react_logger","modules/clean/static_urls","modules/clean/trash/trash_modal","modules/constants/python","modules/core/i18n"],function(e,t,n,r,s,a,i,o,l,c,u,d,p,m,_,h,f,g,E,v,y,S){"use strict";var T=(function(e){function t(t){var n=e.call(this,"TrashView",t)||this;return n.state={scrollPosition:0},n.removeRowByPkey=function(e,t){n.props.onRemoveRow(e,t)},n.purgeCallback=function(e,t,r){c.WebMiscActivityLogger.log("trash-purge",{source:r,with_mixed_cs:!0}),n.removeRowByPkey(e,t)},n.launchModal=function(e,t,r){c.WebMiscActivityLogger.log("trash-modal-launch",{type:t}),h.Modal.showInstance(l.createElement(v.TrashModal,{event:r,restoreCallback:function(){return n.rollbackCallback("modal")},purgeCallback:function(){return n.purgeCallback(r.ns_id,e,"modal")},type:t,userId:n.props.user.id}))},n.updateOnScroll=function(){var e=window.pageYOffset;if(Math.abs(e-n.state.scrollPosition)>n.props.listItemHeight)return n.setState({scrollPosition:e})},n.renderTrashRow=function(e,t,a){var i=e.is_folder,o=e.file_count>1&&!i,c=i||o,u=c?"group":"single";return l.createElement(s.CulledMediaRow,{key:e.pkey,doubleLine:!0,className:r("mc-table-row-culled",{"trash-group-item":!!c}),onClick:function(){return n.launchModal(e.pkey,u,e)},topOffset:a},function(t){var r=t.isHovered;return[l.createElement(s.MediaCell,{key:"event_title",highlight:r,icon:n.renderEventIcon(e,o),title:e.file_name,subtitle:n.renderDeletionPath(e.src_path)}),l.createElement(s.MediaCell,{key:"event_meta",title:e.ago,subtitle:e.name?S._("by %(event_name)s").format({event_name:e.name}):void 0,variant:"detail"})]})},n}return n.__extends(t,e),t.prototype.componentDidMount=function(){window.addEventListener("scroll",this.updateOnScroll),this.updateOnScroll(),e.prototype.componentDidMount.call(this)},t.prototype.componentWillUnmount=function(){window.removeEventListener("scroll",this.updateOnScroll)},t.prototype.rollbackCallback=function(e){c.WebMiscActivityLogger.log("trash-restore",{source:e,with_mixed_cs:!0})},t.prototype.renderDeletionPath=function(e){if(e){for(var t=[{name:"Dropbox",url:""}],n=0,r=e.split("/");n<r.length;n++){var s=r[n];t.push({name:s,url:""})}return l.createElement("span",{className:"deletion-path"},l.createElement(d,{paths:t,viewingUserId:this.props.user.id,useLinks:!1,pathClassname:"deletion-path__item",maxWidth:25}))}},t.prototype.renderEventIcon=function(e,t){return l.createElement("div",{className:r({"trash-row-icon-stacked":t})},l.createElement(u,{icon:e.icon}),t?l.createElement(u,{icon:e.icon}):void 0)},t.prototype.renderTrashContent=function(){return l.createElement(a.Table,{columnFlex:[3,2],key:"trash-content"},l.createElement(a.FixedTableHead,null,l.createElement(a.TableHeadCell,null,S._("Name")),l.createElement(a.TableHeadCell,null,S._("Deleted"))),l.createElement(a.CulledTableBody,{items:this.props.events,listItemHeight:this.props.listItemHeight,renderRow:this.renderTrashRow}))},t.prototype.maybeRenderEVHUpsellBanner=function(){var e=this.props.user,t=l.createElement("div",{className:"trash-evh-upsell-banner",key:"evhupsell"},l.createElement("span",null,S._("Deleted files are stored up to 30 days. Want 120 days of file recovery?")),l.createElement("br",null),S._("Keep your files safe and secure when you "),l.createElement("a",{href:"/plans",target:"_blank",rel:"noopener noreferrer"},S._("upgrade to %(trademark_business)s").format({trademark_business:y.TRADEMARK_BUSINESS})),"."),n=l.createElement("div",{className:"trash-evh-upsell-banner",key:"evhupsell"},l.createElement("span",null,S._("Deleted files are stored up to 30 days. Want to start keeping them for a year?"),l.createElement("br",null),S._("Choose Extended Version History when you "),l.createElement("a",{href:"/plans",target:"_blank",rel:"noopener noreferrer"},S._("upgrade to Dropbox %(trademark_plus)s").format({trademark_plus:y.TRADEMARK_PLUS})),"."));if(!e.is_team){if(!e.paid)return"basic_biz_domain"===this.props.expBizUpsellUserType?t:n;if("pro_biz_domain_can_have_evh"===this.props.expBizUpsellUserType)return t}return null},t.prototype.renderNoTrash=function(){var e=E.static_url("/static/images/empty_states/trash-vflgo8AWd.png");return l.createElement("div",{className:"tab-empty-state",id:"trash-empty-state",key:"notrash"},l.createElement("img",{src:e,alt:""}),l.createElement("div",{className:"empty-explanation"},l.createElement("div",{className:"page-header-text"},S._("You don’t have any recently deleted files")),this.maybeRenderEVHUpsellBanner()))},t.prototype.renderFetchingTrash=function(){return l.createElement("div",{className:"maestro-loading-spinner-wrapper",key:"fetchingtrash"},l.createElement("div",{className:"maestro-loading-spinner"}))},t.prototype.renderFetchingMore=function(){return l.createElement("div",{className:"maestro-loading-spinner-more-data",key:"fetchingmore"},l.createElement("div",{className:"maestro-loading-spinner"}))},t.prototype.renderRestoreFilesTip=function(){return l.createElement("div",{className:"trash-restore-files-tip__shadow",key:"trash-restore-files-tip"},l.createElement(o.VerticallyFixed,{className:"trash-restore-files-tip"},l.createElement(i.TipCard,{onDismiss:this.props.onRestoreFilesTipDismiss,dismissAriaLabel:S._("dismiss")},f.reactFormat(S._("Need help restoring deleted files? <a>Learn more</a>",{project:"maestro"}),{a:l.createElement("a",{href:"/help/9217"})}))))},t.prototype.renderBody=function(){var e=[];return this.props.seenRestoreFilesTip||e.push(this.renderRestoreFilesTip()),this.props.events.length>0?(e.push(this.renderTrashContent()),this.props.handleComponentReady("TrashView"),this.props.loading?e.push(this.renderFetchingMore()):e.push(this.maybeRenderEVHUpsellBanner())):this.props.loading?e.push(this.renderFetchingTrash()):(e.push(this.renderNoTrash()),this.props.handleComponentReady("TrashView")),l.createElement("div",{className:"trash-body"},e)},t.prototype.renderFilterView=function(){return l.createElement(p.FilterView,{className:"trash-filter-view",namespaces:this.props.namespaces.toJS(),activeNS:this.props.activeNS,defaultNS:this.props.defaultNS,onNamespaceChange:this.props.onNamespaceChange,onDateChange:this.props.onDateChange,calendarInitDate:this.props.calendarInitDate,calendarLastDay:this.props.calendarLastDay,calendarAlignAtLeft:!1,disabled:this.props.filterViewDisabled})},t.prototype.render=function(){return l.createElement(_.MaestroChrome,{user:this.props.user,titleRegion:l.createElement(m.MaestroHeaderTitle,null,S._("Deleted files")),embeddedAppRegion:this.renderBody(),actionSidebarRegion:this.renderFilterView()})},t})(g.ReactLogger);T.defaultProps={filterViewDisabled:!1,listItemHeight:72,loading:!1,seenRestoreFilesTip:!1,handleComponentReady:function(e){return null}},t.TrashView=T}),define("modules/clean/react/trash/utils",["require","exports","tslib"],function(e,t,n){"use strict";function r(e){var t=e.match(/^(\d{1,2})-(\d{1,2})-(\d{4})$/);if(null==t)return null;var n=t[1],r=t[2],s=t[3];1===n.length&&(n="0"+n),1===r.length&&(r="0"+r);var a=Date.parse(s+"-"+r+"-"+n);return isNaN(a)?null:Number(new Date(Number(s),Number(r)-1,Number(n)))}function s(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(e){return[2,new Promise(function(e){requestAnimationFrame(function(){return e()})})]})})}t.parseDateFromString=r,t.nextRAF=s}),define("modules/clean/trash/trash_modal",["require","exports","tslib","external/react","external/underscore","modules/clean/ajax","modules/clean/components/loading_indicator","modules/clean/em_string","modules/clean/events/rollback","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/react_logger","modules/clean/static_urls","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri","modules/constants/payments"],function(e,t,n,r,s,a,i,o,l,c,u,d,p,m,_,h,f,g){"use strict";function E(e){return p.static_url("/static/images/icons128/%(icon)s.png".format({icon:e.slice(0,-8)}))}t.SingleModalItem=function(e){return r.createElement("div",{className:"modal-item-row"},r.createElement("div",{className:"modal-item-icon lfloat"},r.createElement(u,{group:"web",name:e.icon,alt:""})),r.createElement("div",{className:"modal-item-name lfloat"},e.name),r.createElement("div",{className:"modal-item-size rfloat"},e.size))},t.SingleModalView=function(e){var t=E(e.icon);return r.createElement("div",{id:"modal-single-container"},r.createElement("div",null,r.createElement("img",{id:"modal-single-icon",src:t,alt:""}),r.createElement("div",{id:"modal-single-name"},o.em_snippet(e.text,34)),r.createElement("div",{id:"modal-single-path"},o.em_snippet(e.src_path,34,0)),r.createElement("div",{id:"modal-single-size"},e.size),r.createElement("div",{id:"modal-single-time"},e.deletionString||"")))};var v=(function(e){function s(t){var n=e.call(this,"GroupModalView",t)||this;return n.TableHeader=function(){return r.createElement("div",{id:"modal-table-header"},r.createElement("div",{id:"modal-path",className:"lfloat"},o.em_snippet(n.props.srcPath,13,0)),r.createElement("div",{id:"modal-timestamp",className:"rfloat"},n.props.deletionString))},n}return n.__extends(s,e),s.prototype.renderEmptyState=function(){return r.createElement("div",{id:"modal-empty-state"},r.createElement("h3",null,_._("This folder is empty")))},s.prototype.renderPreviewUnavailable=function(){return r.createElement("div",{id:"modal-empty-state"},r.createElement("h3",null,_._("Preview not available")))},s.prototype.renderTableContents=function(){var e=this.props,t=e.canDisplayContent,n=e.items;return t?0===n.length?this.renderEmptyState():1===n.length?this.renderSingleModalView(n[0]):this.renderListView():this.renderPreviewUnavailable()},s.prototype.renderSingleModalView=function(e){return r.createElement(t.SingleModalView,{icon:e.icon,text:e.name,src_path:e.src_path,size:e.size})},s.prototype.renderListView=function(){var e=this;return r.createElement("div",null,this.props.items.map(function(t){return e.createSingleModalItem(t)}))},s.prototype.createSingleModalItem=function(e){return r.createElement(t.SingleModalItem,{icon:e.icon,key:e.name,name:o.em_snippet(e.name,35),size:e.size})},s.prototype.render=function(){return r.createElement("div",null,r.createElement(this.TableHeader,null),r.createElement("div",{id:"modal-table-contents"},this.renderTableContents()))},s})(d.ReactLogger);t.GroupModalView=v;var y=(function(e){function u(t){var n=e.call(this,"TrashModal",t)||this;return n.state={items:[],inFlight:!0,error:!1,canDisplayContent:!0},n.ajaxRequest=null,n.handleFetchEventDetailsSuccess=function(e){var t=!0;if("group"===n.props.type){t=!(1===e.length&&!e[0].can_display_content),e=e.filter(function(e){return!(e.src_path===n.props.event.src_path&&e.name===n.props.event.file_name)});var r=n.props.event.file_count;if(r>100){var s=void 0;if(n.props.event.cs_info.can_rollback){var a=n.props.event.file_count-100;s=_.ungettext("And %(num)d more file.","And %(num)d more files.",a).format({num:a})}else s=_._("To view or restore all %(file_count)d files, visit Event Details page.").format({file_count:r});e.push({can_display_content:!0,icon:"",name:s,size:"",src_path:""})}}n.setState({inFlight:!1,canDisplayContent:t,items:e})},n.handleFetchEventDetailsError=function(e){n.userAborted(e)||n.setState({inFlight:!1,error:!0})},n.redirectToEventDetails=function(){var e=n.props,t=e.event,r=e.userId,s=new f({path:"/event_details/"+r+"/"+t.ns_id+"/"+t.cs_info.cs_id+"/0"});m.redirect(s.toString())},n.restoreFiles=function(){var e=n.props.event
;l.rollback(n.props.userId,e.ns_id,e.cs_info.cs_id,!0,n.props.restoreCallback,e.cs_info.sj_ids,!0,e.browse_uri)},n.redirectToUpgrade=function(){var e=g.BUY_URL,t=new f({path:e,query:{oqa:"rf"}});m.redirect(t.toString())},n.purgeFiles=function(){var e=n.props,t=e.event,r=e.userId,s=(i={},i[t.ns_id]=t.cs_info.sj_ids,i);a.WebProgressRequest({url:"/cmd/purge_sjids",data:{ns_to_sjids:JSON.stringify(s)},subject_user:r,progress_text:_._("Deleting files permanently..."),success:function(){h.success(_._("Finished deleting files.")),n.props.purgeCallback()}});var i},n.confirmPurge=function(){var e=n.props.event,t=e.file_count,r=_.ungettext("Permanently delete %(num)d file?","Permanently delete %(num)d files?",t).format({num:t});c.SimpleModal.show({title_text:r,body_html:_._("Are you sure you want to delete <strong>%(filename)s</strong> from your Dropbox permanently?").format({filename:s.escape(e.file_name)}),confirm_text:_._("Delete permanently"),confirm_callback:n.purgeFiles,cancel_text:_._("Cancel")})},n}return n.__extends(u,e),u.prototype.componentWillMount=function(){e.prototype.componentWillMount.call(this),this.fetchEventDetails()},u.prototype.componentWillUnmount=function(){this.ajaxRequest&&this.ajaxRequest.abort()},u.prototype.fetchEventDetails=function(){var e=this.props,t=e.event,n=e.userId,r={user_id:n,ns_id:t.ns_id,sjids:t.cs_info.sj_ids.join(","),page:0};this.ajaxRequest=a.WebRequest({url:"/trash_details/ajax",type:"POST",data:r,dataType:"json",success:this.handleFetchEventDetailsSuccess,error:this.handleFetchEventDetailsError})},u.prototype.userAborted=function(e){return!e.getAllResponseHeaders()},u.prototype.getDeletionTimeString=function(){var e=this.props.event,t={deletor:"",ago:e.ago};if(e.name){var n="single"===this.props.type?25:15;return t.deletor=o.em_snippet(e.name,n),_._("%(deletor)s deleted %(ago)s").format(t)}return _._("You deleted %(ago)s").format(t)},u.prototype.renderError=function(){return r.createElement("div",{id:"modal-error-state"},r.createElement("h3",null,_._("Oops! An error occurred. Please try again later!")))},u.prototype.renderLoader=function(){return r.createElement("div",{id:"modal-loading"},r.createElement(i,{style:i.LoadingIndicatorStyle.BLUE_SPINNER}))},u.prototype.renderSingleModal=function(){var e=this.state.items;if(e.length)return r.createElement(t.SingleModalView,{icon:e[0].icon,text:this.props.event.file_name,src_path:this.props.event.src_path,size:e[0].size,deletionString:this.getDeletionTimeString()})},u.prototype.renderGroupModal=function(){return r.createElement(v,{items:this.state.items,srcPath:this.props.event.src_path,deletionString:this.getDeletionTimeString(),canDisplayContent:this.state.canDisplayContent})},u.prototype.renderModalContainerContents=function(){return this.state.inFlight?this.renderLoader():this.state.error?this.renderError():"single"===this.props.type?this.renderSingleModal():this.renderGroupModal()},u.prototype.render=function(){var e=this.props.event,t=e.cs_info,n=t.can_purge,s=t.can_rollback,a=_._("Go to Event Details"),i="secondary",l=this.redirectToEventDetails;if(s){a="group"===this.props.type&&this.state.items.length>1?_._("Restore all files"):_._("Restore"),"V1"===this.props.expOQProUpsellVariant&&(a=_._("Upgrade to Restore")),i="primary",l="V1"===this.props.expOQProUpsellVariant?this.redirectToUpgrade:this.restoreFiles}var u=r.createElement("div",{id:"modal-table-container"},this.renderModalContainerContents());if(s&&n){var d=_._("Delete permanently"),p=this.confirmPurge;return r.createElement(c.Modal,{title:o.em_snippet(_._("%(text)s").format({text:e.file_name}),30),buttonComponent:r.createElement("div",{className:"db-modal-buttons"},r.createElement("button",{className:"dbmodal-button button-secondary",style:{color:"red",borderColor:"red",backgroundColor:"white"},onClick:p},d),r.createElement("button",{className:"dbmodal-button button-primary",onClick:function(e){c.Modal.close(e.target),l()}},a)),setMaxHeight:!0},u)}return r.createElement(c.Modal,{title:o.em_snippet(_._("%(text)s").format({text:e.file_name}),30),acceptButtonText:a,dismissButtonText:_._("Cancel"),acceptButtonImportance:i,onAccept:l,setMaxHeight:!0},u)},u})(d.ReactLogger);y.defaultProps={restoreCallback:s.noop,purgeCallback:s.noop,type:"group"},t.TrashModal=y});
//# sourceMappingURL=pkg-maestro-deleted_files.min.js-vfldkyWvi.map